
plugins {
    id 'maven-publish'
    id 'signing'
}

import org.gradle.plugins.signing.Sign

publishing {
    publications {
        maven(MavenPublication) {
            groupId = 'io.github.msg134'
            artifactId = 'Command'
            archivesBaseName = "Command"
            version = ivctVersion

            pom {
                name = "Command Interface"
                description = "Command Interface to internal Message Bus"
                url = "https://github.com/MSG134/IVCT_Framework/tree/master/Command"
               licenses {
                  license {
                      name = "The Apache License, Version 2.0"
                      url = "http://www.apache.org/licenses/LICENSE-2.0.txt"
                  }
              }
              developers {
                  developer {
                      id = "rhzg"
                      name = "Reinhard Herzog"
                      email = "reinhard.herzog@iosb.fraunhofer.de"
                 }
              }
              scm {
                 connection = "scm:git:https://github.com/MSG134/IVCT_Framework/tree/development/Command"
                 developerConnection = "scm:git:https://github.com/MSG134/IVCT_Framework/tree/development/Command"
                 url = "https://github.com/MSG134/IVCT_Framework/tree/development/Command"
              }
           }
        }
    }
}


uploadArchives {
  repositories {
    mavenDeployer {
      beforeDeployment { MavenDeployment deployment -> signing.signPom(deployment) }
      repository(url: "https://oss.sonatype.org/service/local/staging/deploy/maven2/") {
        authentication(userName: ossrhUsername, password: ossrhPassword)
      }
      snapshotRepository(url: "https://oss.sonatype.org/content/repositories/snapshots/") {
        authentication(userName: ossrhUsername, password: ossrhPassword)
      }
    }
  }
}

gradle.taskGraph.whenReady { taskGraph ->
    // Do not sign archives by default (a local build without gpg keyring should succeed)
    if (taskGraph.allTasks.any { it.name == 'build' || it.name == 'assemble' }) {
        tasks.findAll { it.name == 'signArchives' || it.name == 'signDocsJar' || it.name == 'signTestJar' }.each { task ->
            task.enabled = false
        }
    }
}

signing
{
    sign configurations.archives
}
build.dependsOn.remove(signArchives)


dependencies {
	compile     libraries.slf4j_api
	compile		libraries.jsonSimple
	compile     project(':MessagingHelpers')

	testCompile libraries.junit
	testCompile libraries.hamcrest_core

	testRuntime libraries.junit
	testRuntime libraries.hamcrest_core
}

javadoc {
			options.addStringOption('XDoclint:none', '-quiet')
			failOnError = false
		}
